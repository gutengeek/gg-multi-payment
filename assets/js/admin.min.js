!function(i){var n=null,s={init:function(){s.sortableInit(),s.searchProducts(),s.addResults(),s.dependencies(),s.removeProduct(),s.refreshIds()},sortableInit:function(){var t=i("#ggmp_selected ul");t.length&&t.sortable({cursor:"move",stop:function(t,o){s.getIds()}}).disableSelection()},searchProducts:function(){i("#ggmp_search").keyup(function(){var o=i("#ggmp_search").val(),e=i("#ggmp_loading"),_=i("#ggmp_results");if(""!==o)return e.show(),null!=n&&clearTimeout(n),n=setTimeout(function(){n=null;var t={action:"ggmp_get_search_results",keyword:o,id:i("#ggmp_id").val(),ids:i("#ggmp_ids").val()};i.ajax({url:ajaxurl,method:"POST",data:t}).done(function(t){_.show(),_.html(t),e.hide(),s.addResults()})},300),!1;_.hide()})},addResults:function(){i("#ggmp_results li").on("click",function(){var o=i(this),t=i(this).data("id");i.ajax({url:ajaxurl,method:"POST",data:{action:"ggmp_add_result_product_meta",id:t}}).done(function(t){t&&(o.remove(),i("#ggmp_selected ul").append(t),i("#ggmp_results").hide(),i("#ggmp_results li").remove(),i("#ggmp_search").val(""),s.reInitWCToolTip(),s.sortableInit(),s.removeProduct(),s.getIds())})})},reInitWCToolTip:function(){i(".tips, .help_tip, .woocommerce-help-tip").tipTip({attribute:"data-tip",fadeIn:50,fadeOut:50,delay:200})},getIds:function(){var t=new Array,o=i("#ggmp_ids");i("#ggmp_selected li").each(function(){i(this).hasClass("ggmp_default")||t.push(i(this).attr("data-id")+"/"+i(this).find("input.ggmp_price").val()+"/"+i(this).find("input.ggmp_qty").val())}),t.length?o.val(t.join(",")):o.val("")},refreshIds:function(){i("#ggmp_selected").on("keyup change click","input",function(){return s.getIds(),!1})},dependencies:function(){i("#ggmp_custom_qty").on("click",function(){i(this).is(":checked")?(i(".ggmp_tr_show_if_custom_qty").show(),i(".ggmp_tr_hide_if_custom_qty").hide()):(i(".ggmp_tr_show_if_custom_qty").hide(),i(".ggmp_tr_hide_if_custom_qty").show())})},removeProduct:function(){i("#ggmp_selected span.remove").on("click",function(){return i(this).closest("li").remove(),s.getIds(),!1})}};i(s.init)}(jQuery);
