!function(y){var v={init:function(){v.run(),v.access(),v.changeQty(),v.hookFoundVariation(),v.hookResetData()},run:function(){y(document).ready(function(t){var a=t(".ggmp-wrap");a.length&&a.each(function(){v.prepareData(t(this))})})},access:function(){y(document).on("click touch",".single_add_to_cart_button",function(t){y(this).hasClass("ggmp-disabled")&&t.preventDefault()}),y(document).on("change",".ggmp-checkbox",function(){var t=y(this).closest(".ggmp-wrap");v.prepareData(t)}),y(document).on("change keyup mouseup",".ggmp-main-qty",function(){var t=y(this).val();y(this).closest(".ggmp-product-main").attr("data-qty",t),y(this).closest(".summary").find("form.cart .quantity .qty").val(t).trigger("change")}),y(document).on("change keyup mouseup",".ggmp-qty",function(){var t,a,o=y(this),r=o.closest(".ggmp-wrap"),e=o.closest(".ggmp-product"),i=e.find(".ggmp-checkbox"),c=parseFloat(o.val());i.prop("checked")&&(t=parseFloat(o.attr("min")),a=parseFloat(o.attr("max")),c<t&&o.val(t),a<c&&o.val(a),e.attr("data-qty",o.val()),v.prepareData(r))})},prepareData:function(t){var a,o,r=t.attr("data-id");void 0!==r&&0<parseInt(r)&&(a=v.getContainer(r),o=t.closest(a),v.isReady(o),v.calcPrice(o),v.saveIds(o),"hide"!==ggmp_params.counter&&v.updateCount(o))},hookFoundVariation:function(){y(document).on("found_variation",function(t,a){var o,r=y(t.target).closest(".ggmp-wrap"),e=y(t.target).closest(".ggmp-products"),i=y(t.target).closest(".ggmp-product");i.length?(o=i.attr("data-new-price"),isNaN(o)&&(o=a.display_price*parseFloat(o)/100),i.find(".ggmp-price-ori").hide(),i.find(".ggmp-price-new").html(v.priceHtml(a.display_price,o)).show(),a.is_purchasable&&a.is_in_stock?(i.attr("data-id",a.variation_id),i.attr("data-price",a.display_price)):i.attr("data-id",0),a.availability_html&&""!==a.availability_html?i.find(".ggmp-availability").html(a.availability_html).show():i.find(".ggmp-availability").html("").hide(),a.image.url&&a.image.srcset&&(i.find(".ggmp-thumb-ori").hide(),i.find(".ggmp-thumb-new").html('<img src="'+a.image.url+'" srcset="'+a.image.srcset+'"/>').show()),y(".product_meta .sku").text(e.attr("data-product-sku")),y(t.target).closest(".variations_form").trigger("reset_image")):(r=y(t.target).closest(".summary").find(".ggmp-wrap"),(e=y(t.target).closest(".summary").find(".ggmp-products")).attr("data-product-id",a.variation_id),e.attr("data-product-sku",a.sku),e.attr("data-product-price",a.display_price)),v.prepareData(r)})},hookResetData:function(){y(document).on("reset_data",function(t){var a=y(t.target).closest(".ggmp-wrap"),o=y(t.target).closest(".ggmp-products"),r=y(t.target).closest(".ggmp-product");r.length?(r.attr("data-id",0),y(t.target).closest(".variations_form").find("p.stock").remove(),y(".product_meta .sku").text(o.attr("data-product-sku")),r.find(".ggmp-availability").html("").hide(),r.find(".ggmp-thumb-new").hide(),r.find(".ggmp-thumb-ori").show(),r.find(".ggmp-price-new").hide(),r.find(".ggmp-price-ori").show()):(a=y(t.target).closest(".summary").find(".ggmp-wrap"),(o=y(t.target).closest(".summary").find(".ggmp-products")).attr("data-product-id",0),o.attr("data-product-price",0),o.attr("data-product-sku",o.attr("data-product-o-sku"))),v.prepareData(a)})},getContainer:function(t){var a=y(".ggmp-wrap-"+t);return a.closest("#product-"+t).length?"#product-"+t:a.closest(".product.post-"+t).length?".product.post-"+t:a.closest("div.product").length?"div.product":"body.single-product"},isReady:function(t){var a=t.find(".ggmp-products"),o=t.find(".ggmp-notice"),r=t.find(".ggmp-ids"),e=t.find(".single_add_to_cart_button"),i=!1,c="";"on"===a.attr("data-optional")&&0<a.find(".ggmp-product-main").length&&(y("form.cart > .quantity").hide(),y("form.cart .woocommerce-variation-add-to-cart > .quantity").hide()),"before_add_to_cart"===ggmp_params.position&&"variable"===a.attr("data-product-type")&&"no"===a.attr("data-variables")&&(a.closest(".ggmp-wrap").insertAfter(r),a.find(".ggmp-qty").removeClass("qty")),a.find(".ggmp-product-together").each(function(){var t=y(this),a=t.find(".ggmp-checkbox").prop("checked"),o=parseInt(t.attr("data-id"));a?(t.removeClass("ggmp-unchecked"),t.hasClass("show-variation-select")||t.find(".variations_form").show()):(t.addClass("ggmp-unchecked"),t.hasClass("show-variation-select")||t.find(".variations_form").hide()),a&&0==o&&(i=!0,""===c&&(c=t.attr("data-name")))}),i?(e.addClass("ggmp-disabled ggmp-selection"),o.html(ggmp_params.text.variation_notice.replace("%s","<strong>"+c+"</strong>")).slideDown()):(e.removeClass("ggmp-disabled ggmp-selection"),o.html("").slideUp())},changeQty:function(){y(document).on("change","form.cart .qty",function(){var t,a,o,r,e,i=y(this),c=parseFloat(i.val());i.hasClass("ggmp-qty")||i.closest("form.cart").find(".ggmp-ids").length&&(t=i.closest("form.cart").find(".ggmp-ids").attr("data-id"),r=(o=(a=y(".ggmp-wrap-"+t)).find(".ggmp-products")).attr("data-optional"),e=o.attr("data-sync-qty"),o.find(".ggmp-product-main").attr("data-qty",c),"on"!==r&&"on"===e&&o.find(".ggmp-product-together").each(function(){var t=parseFloat(y(this).attr("data-qty-ori"))*c;y(this).attr("data-qty",t),y(this).find(".ggmp-qty-num .ggmp-qty").html(t)}),v.prepareData(a))})},calcPrice:function(t){var a,o,r,e,i,c=t.find(".ggmp-products"),s=c.find(".ggmp-product-main"),n=t.find(".ggmp-total"),d=t.find(".single_add_to_cart_button"),_=0,g=0,p="",l=parseFloat(c.attr("data-discount")),u=parseFloat(c.attr("data-product-price")),m=c.attr("data-product-price-suffix"),b=u*parseFloat(d.closest("form.cart").find("input.qty").val()),w=ggmp_params.main_price_selector,h=c.attr("data-show-price"),f=Math.pow(10,Number(ggmp_params.price_decimals)+1);c.find(".ggmp-product-together").each(function(){var t=y(this),a=t.find(".ggmp-checkbox").prop("checked"),o=parseInt(t.attr("data-id")),r=parseFloat(t.attr("data-qty")),e=t.attr("data-new-price"),i=t.attr("data-price-suffix"),c=t.attr("data-price"),s=t.attr("data-regular-price"),n=0,d=0;0<r&&0<o&&(n=r*c,d=isNaN(e)?"100%"==e?(n=r*s,r*c):n*parseFloat(e)/100:r*e,"total"===h&&(t.find(".ggmp-price-ori").hide(),t.find(".ggmp-price-new").html(v.priceHtml(n,d)+i).show()),a&&(_++,g+=d))}),g=Math.round(g*f)/f,s.length&&(a=parseFloat(s.attr("data-qty")),o=s.attr("data-price-suffix"),i=(e=0<g?(r=s.attr("data-new-price"),a*s.attr("data-price")):(r=s.attr("data-price"),a*s.attr("data-regular-price")),a*r),s.find(".ggmp-price-ori").hide(),s.find(".ggmp-price-new").html(v.priceHtml(e,i)+o).show()),0<_?(p=v.formatPrice(g),n.html(ggmp_params.text.additional_price+" "+p+m).slideDown(),isNaN(l)&&(l=0),b=b*(100-l)/100+g):n.html("").slideUp(),"off"!==ggmp_params.recal_price&&(0<parseInt(c.attr("data-product-id"))?y(w).html(v.formatPrice(b)+m):y(w).html(c.attr("data-product-price-html"))),y(document).trigger("calcPrice",[g,p]),t.find(".ggmp-wrap").attr("data-total",g)},saveIds:function(t){var a=t.find(".ggmp-products"),o=t.find(".ggmp-ids"),i=[];a.find(".ggmp-product-together").each(function(){var t=y(this),a=t.find(".ggmp-checkbox").prop("checked"),o=parseInt(t.attr("data-id")),r=parseFloat(t.attr("data-qty")),e=t.attr("data-new-price");a&&0<r&&0<o&&i.push(o+"/"+e+"/"+r)}),0<i.length?o.val(i.join(",")):o.val("")},updateCount:function(t){var a=t.find(".ggmp-products"),o=t.find(".single_add_to_cart_button"),e=0,i=1;a.find(".ggmp-product-together").each(function(){var t=y(this),a=t.find(".ggmp-checkbox").prop("checked"),o=parseInt(t.attr("data-id")),r=parseFloat(t.attr("data-qty"));a&&0<r&&0<o&&(e+=r,i++)}),o.closest("form.cart").find("input.qty").length&&(e+=parseFloat(o.closest("form.cart").find("input.qty").val())),1<i?"individual"===ggmp_params.counter?o.text(ggmp_params.text.add_to_cart+" ("+i+")"):o.text(ggmp_params.text.add_to_cart+" ("+e+")"):o.text(ggmp_params.text.add_to_cart),y(document.body).trigger("updateCount",[i,e])},priceHtml:function(t,a){return a<t?"<del>"+v.formatPrice(t)+"</del> <ins>"+v.formatPrice(a)+"</ins>":v.formatPrice(t)},formatPrice:function(t){var a='<span class="woocommerce-Price-amount amount">',o=v.formatMoney(t,ggmp_params.price_decimals,"",ggmp_params.price_thousand_separator,ggmp_params.price_decimal_separator);switch(ggmp_params.price_format){case"%1$s%2$s":a+='<span class="woocommerce-Price-currencySymbol">'+ggmp_params.currency_symbol+"</span>"+o;break;case"%1$s %2$s":a+='<span class="woocommerce-Price-currencySymbol">'+ggmp_params.currency_symbol+"</span> "+o;break;case"%2$s%1$s":a+=o+'<span class="woocommerce-Price-currencySymbol">'+ggmp_params.currency_symbol+"</span>";break;case"%2$s %1$s":a+=o+' <span class="woocommerce-Price-currencySymbol">'+ggmp_params.currency_symbol+"</span>";break;default:a+='<span class="woocommerce-Price-currencySymbol">'+ggmp_params.currency_symbol+"</span> "+o}return a+="</span>"},formatMoney:function(t,a,o,r,e){t=t||0,a=isNaN(a=Math.abs(a))?2:a,o=void 0!==o?o:"$",r=void 0!==r?r:",",e=void 0!==e?e:".";var i=t<0?"-":"",c=parseInt(t=Math.abs(+t||0).toFixed(a),10)+"",s=0;return 3<c.length&&(s=c.length%3),o+i+(s?c.substr(0,s)+r:"")+c.substr(s).replace(/(\d{3})(?=\d)/g,"$1"+r)+(a?e+Math.abs(t-c).toFixed(a).slice(2):"")}};y(v.init)}(jQuery);
